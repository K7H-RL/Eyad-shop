<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجري الإلكتروني</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">

    <!-- Firebase setup -->
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js"></script>
</head>
<body>

<header>متجري الإلكتروني</header>

<button class="menu-btn" id="menuBtn">&#9776;</button>
<nav class="menu" id="menu">
    <a href="#" id="homeLink">الرئيسية</a>
    <a href="#" id="productsLink">المنتجات</a>
    <a href="#" id="cartLink">السلة</a>
    <a href="#" id="contactLink">تواصل معنا</a>
</nav>

<!-- الرئيسية -->
<div id="homeSection" class="store-description">
    <h2>أهلاً بكم في متجرنا الإلكتروني</h2>
    <p>متجرنا يقدم لك أفضل المنتجات عبر الإنترنت بكل سهولة!</p>
</div>

<!-- المنتجات -->
<div id="productsSection" class="products" style="display:none;"></div>
<div class="no-products" id="noProductsMessage" style="display:none;">لا يوجد منتجات الآن</div>

<!-- السلة -->
<div id="cartSection" class="cart" style="display:none;">
    <h3>سلة المشتريات</h3>
    <div id="cartItems"></div>
    <p id="totalPrice"></p>
    <button id="confirmOrderBtn">تأكيد الطلب</button>
    <p id="confirmationMessage" style="display:none; color: green; margin-top: 10px;">تم استلام طلبك، سيتم التواصل معك</p>

    <!-- معلومات التواصل -->
    <div id="contactInfoSection" style="display: none;">
        <input type="text" id="discordUser" placeholder="اسم مستخدم ديسكورد" /><br>
        <input type="text" id="facebookUser" placeholder="اسم مستخدم فيسبوك" /><br>
        <button id="submitOrderBtn">إرسال الطلب</button>
    </div>
</div>

<!-- إضافة منتج -->
<div id="addProductSection" class="add-product" style="display:none;">
    <h3>إضافة منتج جديد</h3>
    <input type="text" id="newProductName" placeholder="اسم المنتج"><br>
    <input type="number" id="newProductPrice" placeholder="سعر المنتج"><br>
    <input type="text" id="newProductCurrency" placeholder="عملة الدفع"><br>
    <button id="addProductBtn">إضافة المنتج</button>
    <p id="addProductMessage" style="color: green; margin-top: 10px;"></p>
</div>

<!-- الطلبات -->
<div id="ordersSection" class="orders" style="display:none;">
    <h3>جميع الطلبات</h3>
    <div id="ordersList"></div>
</div>

<!-- تواصل معنا -->
<div id="contactSection" class="contact" style="display:none;">
    <h3>تواصل معنا</h3>
    <p>ديسكورد: yourdiscord#1234</p>
    <p>فيسبوك: yourfacebook</p>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, Timestamp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyAGCYyAio3FG6B7R1KGt749gFm4C_u2ank",
        authDomain: "eyad-store1.firebaseapp.com",
        projectId: "eyad-store1",
        storageBucket: "eyad-store1.firebasestorage.app",
        messagingSenderId: "385630644829",
        appId: "1:385630644829:web:ac2e4a80a7d8afdf63fbb4",
        measurementId: "G-B20P7HND34"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // تفعيل البرغر بار لفتح القائمة
    const menuBtn = document.getElementById('menuBtn');
    const menu = document.getElementById('menu');
    menuBtn.addEventListener('click', () => {
        menu.classList.toggle('open');
    });

    // عرض الأقسام عند الضغط على الروابط
    const homeLink = document.getElementById('homeLink');
    const productsLink = document.getElementById('productsLink');
    const cartLink = document.getElementById('cartLink');
    const contactLink = document.getElementById('contactLink');
    const homeSection = document.getElementById('homeSection');
    const productsSection = document.getElementById('productsSection');
    const cartSection = document.getElementById('cartSection');
    const contactSection = document.getElementById('contactSection');
    const noProductsMessage = document.getElementById('noProductsMessage');

    homeLink.addEventListener('click', () => {
        homeSection.style.display = 'block';
        productsSection.style.display = 'none';
        cartSection.style.display = 'none';
        contactSection.style.display = 'none';
    });

    productsLink.addEventListener('click', () => {
        homeSection.style.display = 'none';
        productsSection.style.display = 'block';
        cartSection.style.display = 'none';
        contactSection.style.display = 'none';
    });

    cartLink.addEventListener('click', () => {
        homeSection.style.display = 'none';
        productsSection.style.display = 'none';
        cartSection.style.display = 'block';
        contactSection.style.display = 'none';
    });

    contactLink.addEventListener('click', () => {
        homeSection.style.display = 'none';
        productsSection.style.display = 'none';
        cartSection.style.display = 'none';
        contactSection.style.display = 'block';
    });

    // إضافة منتجات إلى السلة
    const cartItems = [];
    let totalPrice = 0;

    // عرض المنتجات من Firebase
    async function fetchProducts() {
        const querySnapshot = await getDocs(collection(db, "products"));
        const products = [];
        querySnapshot.forEach((doc) => {
            products.push(doc.data());
        });
        displayProducts(products);
    }

    // عرض المنتجات في الصفحة
    function displayProducts(products) {
        if (products.length > 0) {
            productsSection.innerHTML = ''; // تفريغ قسم المنتجات
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                productCard.innerHTML = `
                    <div class="content">
                        <div class="name">${product.name}</div>
                        <div class="price">${product.price} </div>
                        <button class="add-to-cart-btn">إضافة إلى السلة</button>
                    </div>
                `;
                const addToCartBtn = productCard.querySelector('.add-to-cart-btn');
                addToCartBtn.addEventListener('click', () => addToCart(product));
                productsSection.appendChild(productCard);
            });
            noProductsMessage.style.display = 'none';
            productsSection.style.display = 'grid';
        } else {
            noProductsMessage.style.display = 'block';
            productsSection.style.display = 'none';
        }
    }

    // إضافة منتج إلى السلة
    function addToCart(product) {
        const quantity = parseInt(prompt(`كم العدد المطلوب من ${product.name}?`), 10);
        if (isNaN(quantity) || quantity <= 0) {
            alert('الرجاء إدخال رقم صحيح للكمية!');
            return;
        }

        const priceNum = parseFloat(product.price); // تأكد من أن السعر هو عدد صحيح

        if (isNaN(priceNum)) {
            alert('السعر غير صحيح!'); // تحقق من أن السعر موجود بشكل صحيح
            return;
        }

        for (let i = 0; i < quantity; i++) {
            cartItems.push(product);
            totalPrice += priceNum;
        }
        updateCart();
    }

    // تحديث عرض السلة
    function updateCart() {
        const cartItemsDiv = document.getElementById('cartItems');
        cartItemsDiv.innerHTML = '';

        const itemCounts = {};
        cartItems.forEach(item => {
            if (itemCounts[item.name]) {
                itemCounts[item.name].quantity += 1;
            } else {
                itemCounts[item.name] = { price: parseFloat(item.price), currency: item.currency, quantity: 1 };
            }
        });

        for (const [name, details] of Object.entries(itemCounts)) {
            const totalItemPrice = details.price * details.quantity;
            const itemDiv = document.createElement('div');
            itemDiv.textContent = `${name} x${details.quantity} - ${totalItemPrice.toFixed(2)} ${details.currency}`;
            cartItemsDiv.appendChild(itemDiv);
        }

        if (totalPrice && !isNaN(totalPrice)) {
            document.getElementById('totalPrice').textContent = `الإجمالي: ${totalPrice.toFixed(2)}`;
        } else {
            document.getElementById('totalPrice').textContent = `الإجمالي: 0.00`;
        }
    }

    // تأكيد الطلب
    const confirmOrderBtn = document.getElementById('confirmOrderBtn');
    confirmOrderBtn.addEventListener('click', () => {
        document.getElementById('contactInfoSection').style.display = 'block';
    });

    // إرسال الطلب إلى Firebase
    const submitOrderBtn = document.getElementById('submitOrderBtn');
    submitOrderBtn.addEventListener('click', async () => {
        const discordUser = document.getElementById('discordUser').value;
        const facebookUser = document.getElementById('facebookUser').value;
        const orderTime = Timestamp.now();

        if (discordUser && facebookUser) {
            // إرسال الطلب إلى Firebase
            await addDoc(collection(db, "orders"), {
                products: cartItems.map(item => item.name),
                totalPrice,
                contactInfo: { discordUser, facebookUser },
                orderTime
            });

            document.getElementById('confirmationMessage').style.display = 'block';
            cartItems.length = 0; // إفراغ السلة
            totalPrice = 0;
            updateCart();
            document.getElementById('contactInfoSection').style.display = 'none';
        }
    });

    // استدعاء الدالة لعرض المنتجات من Firebase
    fetchProducts();
</script>

</body>
</html>